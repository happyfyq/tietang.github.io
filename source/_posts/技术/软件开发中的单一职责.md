---
title: 软件开发中的单一职责
thumbnail: 'http://7xiovs.com1.z0.glb.clouddn.com/my-pic-P60607-090345.jpg'
date: 2016-06-28 09:06:33
categories:
	- 技术
	- 杂谈
tags:
	- 单一职责
	- 软件开发
	- 微服务

keywords: 单一职责
description:
---

# 软件开发中的单一职责

 
最近在实践微服务化过程中，其“单一职责”原则，解耦是基础。
那么只有微服务化才可以单一职责，才可以解耦吗？答案是否定的。

单一职责原则是这样定义的单一的功能，并且完全封装起来。

做后端开发，应该最熟悉的就是标准的3层架构了，尤其是使用Spring.io体系的：Controller，Service，Dao/Repository。为什么要分层？就是为了保证单一职责，数据模型的事情交给Controller，业务逻辑的事情交给Service，和数据打交道的事情就交给Dao/Repository。有时候或者有些人会分层分的更多，4层，5层，我自己也这样干过，说白了也是为了保证单一职责，3层不能满足单一职责了，耦合度高了，就分。

我们都知道一个webapp在经过一定时间的开发后，就惨不忍睹，即便是有标准的分层，页面或模板文件一大堆，最初的很清晰的3层标准架构也变味了，Controller，Service，Dao/Repository各层之间、Service之间、Dao/Repository之间互相调用，一团乱麻。这个时候没改一行代码都有可能一个老鼠害了一锅汤，bug就如同蚂蚁洞。

### 这些问题最后就造成：
- 可扩展性灵活性差，出现性能问题
- 业务变更和开发困难，维护成本很高，交付时间长
- 回归测试量很大
- ...

为了解决这些问题，就需要时时刻刻清楚的记住“**单一职责**”，**单一职责**可以用到软件开发的任何地方。

应该说职责分离来解耦是最常用最有效的架构方法，这能够很大限度的简化一切。

### 下面就从软件开发、设计、架构，以及重构/演进/进化，从小到大几个方面来说说**单一职责**：

## 类方法/函数

这应该是最小的能体现**单一职责**的程序单元了。最熟悉的最典型的莫过于Helper/Utils类方法了。但不仅仅这样的类方法才可以，每一个类方法都应该遵循**单一职责**原则。这也是为什么有些TL要求类方法代码行数保持在20行左右，其实就是为了保证单一职责，20行左右是一个**经验粗略数字**，大部分单一职责的类方法用20行左右的代码就够了，如果超过20行就要考虑是否保证了单一职责了。那我们在**迭代重构**的过程中就要考虑拆分这样的类方法来保证单一职责。

类方法的单一职责是最单纯的，不惨杂任何额外信息，只关心输入、输出、和职责；一定要明确地定义类方法的职责，保证在迭代中不被错误的扩张，调用方错误的使用。

## 类/函数文件
	
要用面向对象的设计方法，**单一职责原则**来定义类。开发人员一定要很好地理解“单一职责原则”，具有面向对象的抽象思维能力。

当在迭代中一个类过于庞大或者快速膨胀，说明已经有坏味道了，这时候就需要考虑用单一职责原则或者面向对象的分析方法来重构和重新定义类了，通常就是要抽象和拆分类，否则将来会变成一个方法容器。

## 包结构/文件夹

分层就是最常用的架构方法之一，分层具体体现在分包和分类，就是分门别类的意思。俗话说，物以类聚，人以群分。

## 多工程/module

通常以多maven module或者gradle 多module形式存在，来保证单一职责。
当业务量还没有达到服务拆分的火候，又需要规整项目结构，通常在一个app发展的太庞大时或者在工程建设初期采取，从文件系统上隔离，通过module依赖来集成。需要注意的是这样的架构或拆分不是随意的，要以单一职责原则来拆分，更具体一点就是要根据业务，技术框架功能等特性来拆分。

## 微服务/可部署单元

微服务，从运行时隔离，但业务量发展到一定时候，从多module工程拆分或演化出来，可独立打包可独立部署并复合单一原则的application，当然了微服务所体现的价值不仅仅是隔离和独立部署，还有很多这里可以参考[单体应用与微服务优缺点辨析](<http://www.infoq.com/cn/news/2015/04/single-app-micro-service>)。单一职责在微服务中的价值是最重要的，包含了app层面和开发app的团队层面，微服务的大部分优点都可以围绕单一职责来张开。


总之，引用古文名句说明了所有：

- 物以类聚，人以群分。
- 天下之事，分合交替，分久必合，合久必分！
 
 
 
### 参考：

 [http://www.jianshu.com/p/f9d15827465d](<http://www.jianshu.com/p/f9d15827465d>)
 
 [https://zh.wikipedia.org/wiki/单一功能原则](<https://zh.wikipedia.org/wiki/单一功能原则>)


